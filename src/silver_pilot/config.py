import os
from functools import lru_cache
from pathlib import Path

from dotenv import load_dotenv


class Config:
    # 1. 确定当前文件所在目录
    CURRENT_PKG_DIR = Path(__file__).resolve().parent

    # 2. 确定项目根目录
    ROOT_DIR = CURRENT_PKG_DIR.parent.parent

    # 3. 加载根目录下的 .env 文件
    load_dotenv(ROOT_DIR / ".env")

    # 对应你截图里的根目录文件夹
    DATA_DIR = ROOT_DIR / "data"
    FILES_DIR = ROOT_DIR / "files"
    WORKSPACE_DIR = ROOT_DIR / "workspace"
    SCRIPTS_DIR = ROOT_DIR / "scripts"
    TMP_DIR = ROOT_DIR / "tmp"
    LOG_DIR = ROOT_DIR / "logs"

    # --- 环境变量 (带默认值或类型转换) ---
    # 读取你的 API Key 或数据库配置
    # OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
    # DEBUG_MODE = os.getenv("DEBUG", "False").lower() == "true"
    DASHSCOPE_API_KEY = os.getenv("DASHSCOPE_API_KEY")
    NEO4J_URI = os.getenv("NEO4J_URI")
    NEO4J_USER = os.getenv("NEO4J_USER")
    NEO4J_PASSWORD = os.getenv("NEO4J_PASSWORD")

    # --- 自动初始化 (可选) ---
    @classmethod
    def check_dirs(cls) -> None:
        """确保关键目录存在，不存在则自动创建"""
        for attr in ["DATA_DIR", "LOG_DIR"]:
            dir_path = getattr(cls, attr)
            dir_path.mkdir(exist_ok=True)  # 不存在则创建，存在则忽略
            print(f"检查/创建目录：{dir_path}")


# 使用 lru_cache 装饰器实现单例模式
# 避免每次导入都重新读取文件，提高性能
@lru_cache
def get_configs() -> Config:
    Config.check_dirs()
    return Config()


config = get_configs()
